schema: '2.0'
stages:
  merge_data:
    cmd: python src/data/merge_data.py data/raw/ data/interim/data_test_labels.csv
      data/interim/data_train.csv
    deps:
    - path: data/raw/
      md5: 740993cae74002c2587001a4a5306b07.dir
      size: 22905874
      nfiles: 9
    - path: src/data/merge_data.py
      md5: 1af2e8df629a798657fe221676a79147
      size: 6333
    outs:
    - path: data/interim/data_test_labels.csv
      md5: ef24b964f024baad818ec6fd7d3978cd
      size: 156246
    - path: data/interim/data_train.csv
      md5: 0386eb3f967332072dba136b08062867
      size: 32784950
  aggregate_weather:
    cmd: set PYTHONPATH=%PYTHONPATH%;./ && python src/data/aggregate_weather.py data/interim/data_train.csv
      data/interim/data_agg_weather.csv
    deps:
    - path: data/interim/data_train.csv
      md5: 0386eb3f967332072dba136b08062867
      size: 32784950
    - path: src/data/aggregate_weather.py
      md5: 9988031f1f3780ca91970afdeb0add7f
      size: 4691
    - path: src/data/aggregate_weather_config.py
      md5: 220ecb13ca44fc48bf3222c25aa8a566
      size: 2983
    - path: src/data/process_weather.py
      md5: 5b70c5c67b5211222364d51c65b9ced7
      size: 12005
    outs:
    - path: data/interim/data_agg_weather.csv
      md5: a02ba664e8205ba7bdba73cf2b2f6bcd
      size: 8439585
  clip_data:
    cmd: set PYTHONPATH=%PYTHONPATH%;./ && python src/data/clip_outliers.py data/interim/data_agg_weather.csv
      data/interim/data_clipped.csv
    deps:
    - path: data/interim/data_agg_weather.csv
      md5: a02ba664e8205ba7bdba73cf2b2f6bcd
      size: 8439585
    - path: src/data/clip_outliers.py
      md5: 3ab35a574187b84d322a506212a0cb9a
      size: 4457
    params:
      src/config.yml:
        clip_outliers:
          clip_strategy: quantile_clip
          quantile_clip:
            exclude:
            - date
            - hors
            - hour
            - wd
            - month
            - wp
            - windfarm
            lower: 0.05
            upper: 0.95
          iqr_clip:
            exclude:
            - date
            - hors
            - hour
            - wd
            - wp
            - windfarm
    outs:
    - path: data/interim/data_clipped.csv
      md5: f11b0f834795e6307eca9caf13ad10f1
      size: 8523534
  create_features:
    cmd: set PYTHONPATH=%PYTHONPATH%;./ && python src/features/create_features.py
      data/interim/data_clipped.csv data/interim/data_featured.csv
    deps:
    - path: data/interim/data_clipped.csv
      md5: f11b0f834795e6307eca9caf13ad10f1
      size: 8523534
    - path: src/features/create_features.py
      md5: 28606524a00146c780e69af449c1db0b
      size: 10682
    - path: src/features/create_features_config.py
      md5: 275e020e66046b9f51be54d421c0fd43
      size: 4607
    - path: src/features/math_functions.py
      md5: 13a54faaf4b114a43405a2aa83b318b1
      size: 4914
    - path: src/features/process_features.py
      md5: d3492b0a8c6b9e7438dee2f77700b2ca
      size: 18186
    outs:
    - path: data/interim/data_featured.csv
      md5: b6263f21adc8009dbae47e6b6ae9506c
      size: 111721549
  plot_exploratory:
    cmd: set PYTHONPATH=%PYTHONPATH%;./ && python src/visualization/plot_exploratory.py
      data/processed/data_train.csv reports/figures/exploratory/
    deps:
    - path: data/processed/data_train.csv
      md5: bfc394140414cbe1a47566d087136644
      size: 77899595
    - path: src/visualization/plot_exploratory.py
      md5: 353469e66564411f9e9c41f2195c9f7b
      size: 7923
    params:
      src/config.yml:
        plot_exploratory:
          features:
            include:
            - windfarm
            - hour
            - ws
            - wd_sin
            - wd_cos
            - side
            - ws-wd_cos
            - ws_frac
            - ws_log
            - ws_med24
            - ws_l3
            - ws_l12
            exclude: []
          set_plot_params:
            is_on: true
          plot_corr_matrix:
            is_on: true
            cat_col: windfarm
            figsize:
            - 30
            - 15
            fontsize: 14
          plot_boxplot:
            is_on: true
            is_standardized: true
          plot_pairplot:
            is_on: false
            hue_col: windfarm
            kind: reg
            diag_kind: kde
            alpha: 0.3
    outs:
    - path: reports/figures/exploratory/
      md5: f53cdd6955d59ff0c21433cd996c030a.dir
      size: 2516269
      nfiles: 5
  plot_feature_importances:
    cmd: set PYTHONPATH=%PYTHONPATH%;./ && python src/visualization/plot_feature_importance.py
      data/processed/data_train.csv reports/figures/importance/
    deps:
    - path: data/processed/data_train.csv
      md5: bfc394140414cbe1a47566d087136644
      size: 77899595
    - path: src/visualization/plot_feature_importance.py
      md5: 3f0b93d5cf4e441eb3368a8ab223a0ec
      size: 7618
    params:
      src/config.yml:
        plot_feature_importance:
          features:
            include: all
            exclude:
            - date
          windfarm_col: windfarm
          get_permutation_importance:
            is_on: true
            n_repeats: 10
            train_test_cfg:
              test_size: 0.25
              shuffle: true
            random_forest_cfg:
              min_samples_leaf: 10
          plot_power_prediciton:
            is_on: true
            whiskers_len: 10
          plot_params:
            set_plot_params: true
            figsize:
            - 30
            - 15
            fontsize:
    outs:
    - path: reports/figures/importance/
      md5: c57cc889926713f94aa04cb6c2a38bc2.dir
      size: 581830
      nfiles: 3
  split_train_predict:
    cmd: set PYTHONPATH=%PYTHONPATH%;./ && python src/data/split_train_predict.py
      data/interim/data_featured.csv data/processed/data_train.csv data/processed/data_predict.csv
    deps:
    - path: data/interim/data_featured.csv
      md5: b6263f21adc8009dbae47e6b6ae9506c
      size: 111721549
    - path: src/data/split_train_predict.py
      md5: 002856e55f858bc1a49d7d394fbfe467
      size: 1669
    params:
      src/config.yml:
        common.date_col: date
        common.target: wp
        split_train_predict:
          train_rows:
            dates:
            - '2009-07-02 13:00:00'
            - '2012-06-25 00:00:00'
            is_na: false
          predict_rows:
            dates:
            - '2011-01-01 01:00:00'
            - '2012-06-25 00:00:00'
            is_na: true
    outs:
    - path: data/processed/data_predict.csv
      md5: 02b6a60830b92c8df9b25526ea335e7c
      size: 31091754
    - path: data/processed/data_train.csv
      md5: bfc394140414cbe1a47566d087136644
      size: 77899595
